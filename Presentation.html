google.charts.load("current", { packages: ["corechart"] });
        
async function fetchOrderData() {
  try {
    // Fetch data from server
    const response = await fetch('/getOrderData');
if (!response.ok) throw new Error('Failed to fetch order data');

const data = await response.json();


// Validate data format
if (!Array.isArray(data) || data.length === 0) {
throw new Error('No Clients Yet');
}

// Function to fetch client details by ID
async function fetchClientName(id) {
try {
const res = await fetch(`/ClientDetails/${id}`);
if (!res.ok) throw new Error(`Failed to fetch details for ClientID: ${id}`);
const clientDetails = await res.json();
return clientDetails.ClientName; // Assuming the API returns an object with a `name` property
} catch (err) {
console.error(err.message);
return id; // Fallback to ID if the name cannot be fetched
}
}

// Build chartData array
const chartData = [['Client Name', 'Order Amount']];

for (const item of data) {
if (item.ClientID && item.TotalOrder) {
const clientName = await fetchClientName(item.ClientID); // Fetch name by ID
chartData.push([clientName, item.TotalOrder]);
}
}

    // Ensure chartData has at least one row of data
    if (chartData.length <= 1) {
      throw new Error('No valid investment data to display');
    }

    // Draw chart
    drawChart(chartData);
  } catch (error) {
    console.error('Error fetching investment data:', error.message);
    document.getElementById('piechart_3d').innerHTML = `
      <p class="text-danger">Failed to load chart data: ${error.message}</p>
    `;
  }
}

function drawChart(chartData) {
  try {
    // Validate chartData
    if (!Array.isArray(chartData) || chartData.length <= 1) {
      throw new Error('Invalid chart data');
    }

    const data = google.visualization.arrayToDataTable(chartData);

    const options = {
      is3D: true,
      width: 600,
      height: 600,
      pieSliceText: 'value', // Show investment amounts directly on slices
    };

    const chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
    chart.draw(data, options);
  } catch (error) {
    console.error('Error drawing chart:', error.message);
    document.getElementById('piechart_3d').innerHTML = `
      <p class="text-danger">Error drawing chart: ${error.message}</p>
    `;
  }
}

document.addEventListener('DOMContentLoaded', fetchOrderData);

</script>
<script>
async function fetchData() {
    try {

        const response = await fetch('/ClientsData');
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
    

        const container = document.getElementById('profile-cards-container');
        container.innerHTML = ''; // Clear existing cards

        if (data.length === 0) {
            container.innerHTML = `<p class="text-center text-muted">No Clients found.</p>`;
            return;
        }

        data.forEach(client => {
            const profileCard = document.createElement('div');
            profileCard.classList.add('col-md-4', 'mb-4');

            // Fallback to placeholder if no image is available
            const imageUrl = client.Image ;

            profileCard.innerHTML = `
                <div class="profile-card border shadow p-3 rounded">
                    <img src="../Images/DummyProfile.png" alt="${client.ClientName}" class="profile-image img-fluid rounded-circle mb-3">
                    <h2 class="text-primary">${client.ClientName}</h2>
                    <p class="job-title text-muted">ID: ${client.ClientID}</p>
                    <div class="profile-details mt-3">
                        <div class="detail-row">
                            <span><strong>Total Loan Amount :</strong></span>
                            <span>${new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(client.TotalAmount)}</span>
                        </div>
                       
                        <div class="detail-row">
                            <span><strong>Phone Number:</strong></span>
                            <span>${client.PhoneNumber}</span>
                        </div>
                    </div>
                </div>
            `;


            profileCard.querySelector('.profile-card').addEventListener('click', () => {
window.location.href = `/Client/${encodeURIComponent(client.ClientID)}`;
});
     
            container.appendChild(profileCard);
        });
    } catch (error) {
        console.error('Error fetching data:', error);
        const container = document.getElementById('profile-cards-container');
        container.innerHTML = `<p class="text-center text-danger">Error loading investor data. Please try again later.</p>`;
    }



    function investor(ID) {
window.location.href = `/Client/${encodeURIComponent(ID)}`;
}
}

document.addEventListener('DOMContentLoaded', fetchData);
</script>

<script>


function filterData(query) {
const container = document.getElementById('profile-cards-container');
container.innerHTML = ''; // Clear existing cards

const filteredData = originalData.filter(investment => {
return (
    (investment.InvestorName && investment.InvestorName.toLowerCase().includes(query.toLowerCase())) ||
    (investment.AmountInvested && investment.AmountInvested.toString().includes(query)) ||
    (investment.InvestorID && investment.InvestorID.toLowerCase().includes(query.toLowerCase())) ||
    (investment.PhoneNumber && investment.PhoneNumber.toString().includes(query))
);
});

if (filteredData.length === 0) {
container.innerHTML = '<p class="text-center text-danger">No matching results found.</p>';
return;
}

// Display filtered data
filteredData.forEach(investor => {
const profileCard = document.createElement('div');
profileCard.classList.add('col-md-4', 'mb-4');
const imageUrl = investor.Image || '../Images/DummyProfile.png';

profileCard.innerHTML = `
    <div class="profile-card border shadow p-3 rounded" onclick="investor(${investor.InvestorID})">
        <img src="${imageUrl}" alt="${investor.InvestorName}" class="profile-image img-fluid rounded-circle mb-3">
        <h2 class="text-primary">${investor.InvestorName}</h2>
        <p class="job-title text-muted">ID: ${investor.InvestorID}</p>
        <div class="profile-details mt-3">
            <div class="detail-row">
                <span><strong>Total Amount Invested:</strong></span>
                <span>${new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(investor.AmountInvested)}</span>
            </div>
            <div class="detail-row">
                <span><strong>Phone Number:</strong></span>
                <span>${investor.PhoneNumber}</span>
            </div>
        </div>
    </div>
`;

container.appendChild(profileCard);
profileCard.querySelector('.profile-card').addEventListener('click', () => {
    window.location.href = `/investor/${encodeURIComponent(investor.InvestorID)}`;})
});

}

document.getElementById('searchBar').addEventListener('input', (e) => {
filterData(e.target.value);
});
